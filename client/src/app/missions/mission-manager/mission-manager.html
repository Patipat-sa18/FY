@if (notificationMessage) {
<div class="notification-overlay" (click)="closeNotification()">
    <div class="notification-card" (click)="$event.stopPropagation()">
        <mat-icon>info</mat-icon>
        <p>{{ notificationMessage }}</p>
    </div>
</div>
}

<div class="page-container">
    <div class="page-header">
        <div class="header-content">
            <h2>My Missions</h2>
        </div>
        <div class="header-actions">
            <button class="add-btn" (click)="openDialog()">
                <mat-icon>add</mat-icon> Create New Mission
            </button>
        </div>
    </div>

    <div class="mission-list">
        @for (mission of myMissions$ | async; track mission.id) {
        <div class="mission-card">
            @if (isEditing(mission.id)) {
            <!-- Edit Mode -->
            <div class="card-header editing">
                <h3>Editing Mission</h3>
                <div class="actions">
                    <button class="primary" (click)="saveEdit()">Save</button>
                    <button (click)="cancelEdit()">Cancel</button>
                </div>
            </div>

            <div class="card-body form-grid">
                <div class="form-group">
                    <label>Mission Name</label>
                    <input type="text" [(ngModel)]="editForm.name" placeholder="Enter name" />
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <input type="text" [(ngModel)]="editForm.description" placeholder="Enter description" />
                </div>

                <div class="form-group">
                    <label>Max Crew</label>
                    <div class="crew-input">
                        <input type="number" [(ngModel)]="editForm.max_crew" placeholder="Max" />
                        <span>(Current: {{mission.crew_count}})</span>
                    </div>
                </div>
            </div>

            } @else {
            <!-- View Mode -->
            <div class="card-header">
                <div class="name-container">
                    <mat-icon class="header-icon">assignment</mat-icon>
                    <h3>{{mission.name}}</h3>
                </div>
                <div class="status-badge" [class]="mission.status">{{mission.status}}</div>
            </div>

            <div class="card-body">
                <div class="info-item full-width">
                    <div class="info-header">
                        <mat-icon>description</mat-icon>
                        <label>Description</label>
                    </div>
                    <p>{{mission.description || 'No description provided'}}</p>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-header">
                            <mat-icon>group</mat-icon>
                            <label>Crew Members</label>
                        </div>
                        <div class="info-value">
                            <span>{{mission.crew_count}}</span>
                            <span class="separator">/</span>
                            <span class="max">{{mission.max_crew}}</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-header">
                            <mat-icon>calendar_today</mat-icon>
                            <label>Created Date</label>
                        </div>
                        <span>{{mission.created_at | date:'mediumDate'}}</span>
                    </div>

                    <div class="info-item">
                        <div class="info-header">
                            <mat-icon>update</mat-icon>
                            <label>Last Updated</label>
                        </div>
                        <span>{{mission.updated_at | date:'mediumDate'}}</span>
                    </div>
                </div>
            </div>

            <div class="card-actions">
                @if(mission.status === 'Open') {
                <button class="btn primary" (click)="start(mission.id)">
                    <mat-icon>play_arrow</mat-icon> Start
                </button>
                }
                @if(mission.status === 'InProgress') {
                <button class="btn primary" (click)="complete(mission.id)">
                    <mat-icon>check_circle</mat-icon> Complete
                </button>
                <button class="btn warn" (click)="fail(mission.id)">
                    <mat-icon>error</mat-icon> Fail
                </button>
                }
                <button class="btn" (click)="startEdit(mission)">
                    Edit Mission
                </button>
                <button class="btn danger" (click)="deleteMission(mission.id)">
                    Delete
                </button>
            </div>
            }
        </div>
        }
    </div>
</div>